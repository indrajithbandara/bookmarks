#!/usr/bin/env node

// TODO: Remove this hardcoded junk -- use commander or optimist to parse options
// Load in bookmarks and options
console.log('Loading content...');
var cwd = process.cwd(),
    bookmarks = require(cwd + '/bookmarks.orig.json'),
    options = require(cwd + '/config');

// Parse our bookmarks through the library
// TODO: Switch parser to event emitter based
console.log('Formatting bookmarks...');
var parser = require('../lib/bookmarks'),
    parsedBookmarks = parser(bookmarks, options);

// Guarantee an output folder
var path = require('path'),
    mkdirp = require('mkdirp'),
    outputFile = cwd + '/bookmarks.json',
    outputDir = path.dirname(outputFile);
mkdirp.sync(outputDir);

// Spit out the content into a file
var fs = require('fs'),
    retStr = JSON.stringify(parsedBookmarks, null, 4);
fs.writeFileSync(outputFile, retStr, 'utf8');

var retMinStr = JSON.stringify(parsedBookmarks);
fs.writeFileSync(cwd + '/bookmarks.min.json', retMinStr, 'utf8');

// Notify the user
console.log('Done!');
